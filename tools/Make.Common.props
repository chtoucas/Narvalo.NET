<?xml version="1.0" encoding="utf-8" ?>
<Project ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!--
    Options:
    - LeanRun
    - SignAssembly
    - SolutionFile
    
    Other options may be found in Shared.props.
  -->

  <!-- Import shared properties. -->
  <Import Project="$(MSBuildThisFileDirectory)Shared.props" />

  <!-- Define common Narvalo project properties. -->
  <PropertyGroup>
    <!-- If true, builds behave a lot like if they were run inside Visual Studio. -->
    <LeanRun Condition=" '$(LeanRun)' != 'true' ">false</LeanRun>

    <!-- If true, sign the assemblies. -->
    <SignAssembly Condition=" '$(SignAssembly)' != 'true' ">false</SignAssembly>

    <SolutionFile Condition=" '$(SolutionFile)' == '' ">$(RepositoryRoot)Narvalo.sln</SolutionFile>

    <WorkRoot>$(RepositoryRoot)work\</WorkRoot>

    <WorkArtefactsDir>$(WorkRoot)artefacts\</WorkArtefactsDir>
  </PropertyGroup>

  <!-- Define common MSBuild project properties. -->
  <PropertyGroup>
    <BaseIntermediateOutputPath>$(WorkRoot)obj\</BaseIntermediateOutputPath>
    <IntermediateOutputPath>$(BaseIntermediateOutputPath)$(Configuration)\</IntermediateOutputPath>

    <BaseOutputPath>$(WorkRoot)bin\</BaseOutputPath>
    <OutputPath>$(BaseOutputPath)$(Configuration)\</OutputPath>
  </PropertyGroup>

  <!-- Define the PEVerifyDummyOutput property. -->
  <PropertyGroup>
    <PEVerifyDummyOutput>$(IntermediateOutputPath)Narvalo.Verify.out</PEVerifyDummyOutput>
  </PropertyGroup>

  <!-- Define the PEVerifyLogFile property. -->
  <PropertyGroup>
    <PEVerifyLogFile>$(WorkArtefactsDir)peverify.log</PEVerifyLogFile>
  </PropertyGroup>

  <!-- Define the XUnitLogFile property. -->
  <PropertyGroup>
    <XUnitLogFile>$(WorkArtefactsDir)xunit.xml</XUnitLogFile>
  </PropertyGroup>

  <!-- Define the NuGetCommand property. -->
  <PropertyGroup>
    <NuGetCommand>$(MSBuildThisFileDirectory)NuGet\nuget.exe</NuGetCommand>
  </PropertyGroup>

  <!-- Define the PEVerifyCommand property. -->
  <PropertyGroup>
    <PEVerifyCommand>$(SDK40ToolsPath)PEVerify.exe</PEVerifyCommand>
  </PropertyGroup>

  <!-- Define the BuildProperties property. -->
  <PropertyGroup>
    <!--
      I set both OutDir and OutputPath, but I guess only one is really necessary.
      If I had to keep one it ought to be OutDir. More documentation here:
        %ProgramFiles(x86)%\MSBuild\$(VisualStudioVersion)\Bin\Microsoft.Common.CurrentVersion.targets
      
      WARNING: When building a PCL project, MSBuild places its output inside
      a subdirectory of OutDir. To correct this, we instruct MSBuild to
      use the standard behaviour: GenerateProjectSpecificOutputFolder = false.
    -->
    <BuildProperties>
      BuildInParallel=$(BuildInParallel);
      Configuration=$(Configuration);
      Platform=$(Platform);
      RepositoryRoot=$(RepositoryRoot);
      VisualStudioVersion=$(VisualStudioVersion);

      BaseIntermediateOutputPath=$(BaseIntermediateOutputPath);
      OutDir=$(OutputPath);
      OutputPath=$(OutputPath);
      GenerateProjectSpecificOutputFolder=false
    </BuildProperties>
  </PropertyGroup>

  <!-- Define the AdditionalProperties property. -->
  <PropertyGroup Condition=" '$(LeanRun)' != 'true' ">
    <AdditionalProperties>
      CustomBeforeNarvaloProps=$(MSBuildThisFileDirectory)Make.CustomBefore.props;
      CustomAfterNarvaloProps=$(MSBuildThisFileDirectory)Make.CustomAfter.props;
      CustomBeforeNarvaloTargets=$(MSBuildThisFileDirectory)Make.CustomBefore.targets;
      CustomAfterNarvaloTargets=$(MSBuildThisFileDirectory)Make.CustomAfter.targets;

      Make_SignAssembly=$(SignAssembly);
      Make_WorkArtefactsDir=$(WorkArtefactsDir)
    </AdditionalProperties>
  </PropertyGroup>

  <!-- Marks Make.Common.props as already imported. -->
  <PropertyGroup>
    <MakeCommonPropsImported>true</MakeCommonPropsImported>
  </PropertyGroup>
</Project>
