<?xml version="1.0" encoding="utf-8" ?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="$(MSBuildThisFileDirectory)Shared.props" />
  <Import Project="$(MSBuildThisFileDirectory)Make.Settings.props" />
  
  <!-- Define common Narvalo project properties. -->
  <PropertyGroup>
    <WorkRoot>$(RepositoryRoot)work\</WorkRoot>

    <WorkReportsDir>$(WorkRoot)reports\</WorkReportsDir>
    <WorkStagingDir>$(WorkRoot)staging\</WorkStagingDir>
  </PropertyGroup>

  <!-- Define common MSBuild project properties. -->
  <PropertyGroup>
    <BaseIntermediateOutputPath>$(WorkRoot)obj\</BaseIntermediateOutputPath>
    <IntermediateOutputPath>$(BaseIntermediateOutputPath)$(Configuration)\</IntermediateOutputPath>

    <BaseOutputPath>$(WorkRoot)bin\</BaseOutputPath>
    <OutputPath>$(BaseOutputPath)$(Configuration)\</OutputPath>
  </PropertyGroup>

  <!-- Define the SolutionName property. -->
  <PropertyGroup>
    <SolutionName>Narvalo.sln</SolutionName>
  </PropertyGroup>

  <!-- Define the SolutionFile property. -->
  <PropertyGroup>
    <SolutionFile>$(RepositoryRoot)$(SolutionName)</SolutionFile>
  </PropertyGroup>

  <!-- Define the AssemblyInfoFile property. -->
  <PropertyGroup>
    <AssemblyInfoFile>$(RepositorySettingsDir)AssemblyInfo.Version.cs</AssemblyInfoFile>
  </PropertyGroup>

  <!-- Define the PEVerifyLogFile property. -->
  <PropertyGroup>
    <PEVerifyLogFile>$(WorkRoot)peverify.log</PEVerifyLogFile>
  </PropertyGroup>

  <!-- Define the XUnitReportFile property. -->
  <PropertyGroup>
    <XUnitReportFile>$(WorkReportsDir)xunit.xml</XUnitReportFile>
  </PropertyGroup>

  <!-- Define the NuGetCommand property. -->
  <PropertyGroup>
    <NuGetCommand>$(MSBuildThisFileDirectory)NuGet\nuget.exe</NuGetCommand>
  </PropertyGroup>

  <!-- Define the VerifyBuildDummyOutput property. -->
  <PropertyGroup>
    <VerifyBuildDummyOutput>$(IntermediateOutputPath)Narvalo.Verify.txt</VerifyBuildDummyOutput>
  </PropertyGroup>

  <!-- Define the AdditionalConstants property. -->
  <PropertyGroup>
    <AdditionalConstants></AdditionalConstants>
  </PropertyGroup>

  <!-- Define the AdditionalProperties property. -->
  <PropertyGroup>
    <!-- Even if this is not necessary, we include RepositoryRoot to speed up tihngs. -->
    <AdditionalProperties>
      RepositoryRoot=$(RepositoryRoot);
      WorkReportsDir=$(WorkReportsDir)
    </AdditionalProperties>
  </PropertyGroup>

  <!-- Define the BuildProperties property. -->
  <PropertyGroup>
    <!--
      Attempt to use a completely different working directory from the one used by VS.

      WARNING: When building a PCL project, MSBuild places its output inside
      a subdirectory of $(OutDir). To correct this, we instruct MSBuild to
      use the standard behaviour: GenerateProjectSpecificOutputFolder = false.

      Here is the documentation directly taken from:
        %ProgramFiles(x86)%\MSBuild\$(VisualStudioVersion)\Bin\Microsoft.Common.CurrentVersion.targets

      Several properties must be set in the main project file, before using this .TARGETS file.
      However, if the properties are not set, we pick some defaults.

      OutDir:
      Indicates the final output location for the project or solution. When building a solution,
      OutDir can be used to gather multiple project outputs in one location. In addition,
      OutDir is included in AssemblySearchPaths used for resolving references.

      OutputPath:
      This property is usually specified in the project file and is used to initialize OutDir.
      OutDir and OutputPath are distinguished for legacy reasons, and OutDir should be used if at all possible.

      BaseIntermediateOutputPath:
      This is the top level folder where all configuration specific intermediate output folders will be created.
      Default value is obj\

      IntermediateOutputPath:
      This is the full intermediate Output Path, and is derived from BaseIntermediateOutputPath, if none specified
      (eg. obj\debug). If this property is overridden, then setting BaseIntermediateOutputPath has no effect.
    -->
    <BuildProperties>
      Configuration=$(Configuration);
      Platform=$(Platform);
      BuildInParallel=$(BuildInParallel);
      BaseIntermediateOutputPath=$(BaseIntermediateOutputPath);
      OutDir=$(OutputPath);
      OutputPath=$(OutputPath);
      GenerateProjectSpecificOutputFolder=false;
      VisualStudioVersion=$(VisualStudioVersion);
      CustomBeforeNarvaloProps=$(MSBuildThisFileDirectory)Make.CustomBefore.props;
      CustomAfterNarvaloProps=$(MSBuildThisFileDirectory)Make.CustomAfter.props;
      CustomBeforeNarvaloTargets=$(MSBuildThisFileDirectory)Make.CustomBefore.targets;
      CustomAfterNarvaloTargets=$(MSBuildThisFileDirectory)Make.CustomAfter.targets
    </BuildProperties>
  </PropertyGroup>
  
  <!-- If true, Make.Common.props has already been imported. -->
  <PropertyGroup>
    <MakeCommonPropsHasBeenImported>true</MakeCommonPropsHasBeenImported>
  </PropertyGroup>
</Project>
