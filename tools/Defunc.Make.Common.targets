<?xml version="1.0" encoding="utf-8" ?>
<Project ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- Define the AssemblyInfo itemGroup. -->
  <ItemGroup>
    <AssemblyInfo Include="Core">
      <Major>0</Major>
      <Minor>26</Minor>
      <Patch>0</Patch>
      <PreRelaseLabel></PreRelaseLabel>
    </AssemblyInfo>

    <AssemblyInfo Include="Mvp">
      <Major>1</Major>
      <Minor>0</Minor>
      <Patch>0</Patch>
      <PreRelaseLabel>beta</PreRelaseLabel>
    </AssemblyInfo>
  </ItemGroup>

  <Target Name="_CreateAssemblyInfo" DependsOnTargets="_PrepareAssemblyInfo">
    <Message Text="Creating the build generated assembly info..." Importance="high" />

    <PropertyGroup>
      <_AssemblyInfoContent>
        <![CDATA[
//------------------------------------------------------------------------------
// <auto-generated>
// This code was generated by a tool. Changes to this file may cause incorrect
// behavior and will be lost when the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System.Reflection;

#if BUILD_GENERATED_VERSION
@(AssemblyInfo -> '%(CodeFragment)', '')
#endif

         ]]>
      </_AssemblyInfoContent>
      <_AssemblyInfoLines>$([MSBuild]::Escape($(_AssemblyInfoContent)))</_AssemblyInfoLines>
    </PropertyGroup>

    <WriteLinesToFile Lines="$(_AssemblyInfoLines)"
                      File="$(AssemblyInfoFile)"
                      Overwrite="true" />
  </Target>

  <Target Name="_IncrementBuildAndRevisionNumbers">
    <IncrementBuildAndRevisionNumbers>
      <Output TaskParameter="BuildNumber" PropertyName="BuildNumber"/>
      <Output TaskParameter="RevisionNumber" PropertyName="RevisionNumber"/>
    </IncrementBuildAndRevisionNumbers>
  </Target>

  <Target Name="_PrepareAssemblyInfo"
          DependsOnTargets="_IncrementBuildAndRevisionNumbers"
          Outputs="%(AssemblyInfo.Identity)">
    <!-- Batch enrichment of @(AssemblyInfo) which is defined in Build.settings.props.
         WARNING: Keep the next ItemGroup's separated, otherwise that won't work.
         While enriching the AssemblyInfo metadata, each step uses metadata
         only defined after completion of the previous step. -->

    <PropertyGroup>
      <_CurrentAssemblyInfo>%(AssemblyInfo.Identity)</_CurrentAssemblyInfo>
    </PropertyGroup>

    <ItemGroup>
      <AssemblyInfo Condition=" '%(AssemblyInfo.Identity)' == '$(_CurrentAssemblyInfo)' ">
        <Version>%(AssemblyInfo.Major).%(AssemblyInfo.Minor).0.0</Version>
        <FileVersion>%(AssemblyInfo.Major).%(AssemblyInfo.Minor).$(BuildNumber).$(RevisionNumber)</FileVersion>
        <InformationalVersion>%(AssemblyInfo.Major).%(AssemblyInfo.Minor).%(AssemblyInfo.Patch)</InformationalVersion>
      </AssemblyInfo>
    </ItemGroup>

    <ItemGroup>
      <AssemblyInfo Condition=" '%(AssemblyInfo.Identity)' == '$(_CurrentAssemblyInfo)' ">
        <InformationalVersion Condition=" '%(AssemblyInfo.PreRelaseLabel)' != '' ">%(AssemblyInfo.InformationalVersion)-%(AssemblyInfo.PreRelaseLabel)</InformationalVersion>
      </AssemblyInfo>
    </ItemGroup>

    <ItemGroup>
      <AssemblyInfo Condition=" '%(AssemblyInfo.Identity)' == '$(_CurrentAssemblyInfo)' ">
        <CodeFragment>
          <![CDATA[
#if %(AssemblyInfo.CompilationSymbol)
[assembly: AssemblyVersion("%(AssemblyInfo.Version)")]
[assembly: AssemblyFileVersion("%(AssemblyInfo.FileVersion)")]
[assembly: AssemblyInformationalVersion("%(AssemblyInfo.InformationalVersion)")]
#endif
         ]]>
        </CodeFragment>
      </AssemblyInfo>
    </ItemGroup>
  </Target>
</Project>
